<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Online Bookstore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-book"></i> BookStore
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link" href="/books">Books</a>
                <a class="nav-link" href="/cart">Cart</a>
                <a class="nav-link" href="/orders">My Orders</a>
                <a class="nav-link" href="/login">Login</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2><i class="fas fa-credit-card"></i> Checkout</h2>
        
        <!-- Progress Bar -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="progress">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 75%">
                        Cart ‚Üí Checkout ‚Üí Payment ‚Üí Confirmation
                    </div>
                </div>
            </div>
        </div>
        
        <form th:action="@{/orders/place}" method="post">
            <div class="row">
                <div class="col-md-8">
                    <!-- Customer Information -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-user"></i> Customer Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="firstName" class="form-label">First Name</label>
                                        <input type="text" class="form-control" id="firstName" name="firstName" 
                                               th:value="${user?.firstName}" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="lastName" class="form-label">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" name="lastName" 
                                               th:value="${user?.lastName}" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               th:value="${user?.email}" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="phone" class="form-label">Phone</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               th:value="${user?.phone}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Shipping Information -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-shipping-fast"></i> Shipping Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="shippingAddress" class="form-label">Shipping Address</label>
                                <textarea class="form-control" id="shippingAddress" name="shippingAddress" 
                                         rows="3" th:text="${user?.address}" placeholder="Enter your complete shipping address" required></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="city" class="form-label">City</label>
                                        <input type="text" class="form-control" id="city" name="city" required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="state" class="form-label">State</label>
                                        <input type="text" class="form-control" id="state" name="state" required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="zipCode" class="form-label">ZIP Code</label>
                                        <input type="text" class="form-control" id="zipCode" name="zipCode" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment Information -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-credit-card"></i> Payment Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="paymentMethod" class="form-label">Payment Method</label>
                                <select class="form-select" id="paymentMethod" name="paymentMethod" required>
                                    <option value="">Select Payment Method</option>
                                    <option value="CREDIT_CARD">üí≥ Credit Card</option>
                                    <option value="DEBIT_CARD">üí≥ Debit Card</option>
                                    <option value="PAYPAL">üÖøÔ∏è PayPal</option>
                                    <option value="BANK_TRANSFER">üè¶ Bank Transfer</option>
                                </select>
                            </div>
                            
                            <!-- Credit/Debit Card Details -->
                            <div id="cardDetails" style="display: none;">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mb-3">
                                            <label for="cardNumber" class="form-label">Card Number</label>
                                            <input type="text" class="form-control" id="cardNumber" name="cardNumber" 
                                                   placeholder="1234 5678 9012 3456" maxlength="19">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label for="cardName" class="form-label">Cardholder Name</label>
                                            <input type="text" class="form-control" id="cardName" name="cardName" 
                                                   placeholder="John Doe">
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <label for="expiryMonth" class="form-label">Month</label>
                                            <select class="form-select" id="expiryMonth" name="expiryMonth">
                                                <option value="">MM</option>
                                                <option th:each="i : ${#numbers.sequence(1, 12)}" 
                                                        th:value="${#strings.toString(i).length() == 1 ? '0' + i : i}" 
                                                        th:text="${#strings.toString(i).length() == 1 ? '0' + i : i}">01</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <label for="expiryYear" class="form-label">Year</label>
                                            <select class="form-select" id="expiryYear" name="expiryYear">
                                                <option value="">YY</option>
                                                <option th:each="i : ${#numbers.sequence(2025, 2035)}" 
                                                        th:value="${i}" th:text="${i}">2025</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="cvv" class="form-label">CVV</label>
                                            <input type="text" class="form-control" id="cvv" name="cvv" 
                                                   placeholder="123" maxlength="4">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- PayPal Details -->
                            <div id="paypalDetails" style="display: none;">
                                <div class="alert alert-info">
                                    <i class="fab fa-paypal"></i> You will be redirected to PayPal to complete your payment.
                                </div>
                            </div>
                            
                            <!-- Bank Transfer Details -->
                            <div id="bankDetails" style="display: none;">
                                <div class="alert alert-info">
                                    <i class="fas fa-university"></i> Bank transfer instructions will be provided after order confirmation.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Order Summary -->
                <div class="col-md-4">
                    <div class="card sticky-top">
                        <div class="card-header">
                            <h5><i class="fas fa-receipt"></i> Order Summary</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Subtotal:</span>
                                    <span>$79.96</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Shipping:</span>
                                    <span>$5.99</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Tax:</span>
                                    <span>$6.80</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <strong>Total:</strong>
                                    <strong class="text-success">$92.75</strong>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted">
                                    <i class="fas fa-shield-alt"></i> Your payment information is secure and encrypted.
                                </small>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-lock"></i> Place Order
                                </button>
                                <a href="/cart" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left"></i> Back to Cart
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Info -->
                    <div class="card mt-3">
                        <div class="card-body text-center">
                            <div class="mb-2">
                                <i class="fas fa-shield-alt text-success fa-2x"></i>
                            </div>
                            <h6>Secure Checkout</h6>
                            <small class="text-muted">
                                Your personal and payment information is protected with industry-standard encryption.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-5 py-4">
        <div class="container text-center">
            <p>&copy; 2025 Online Bookstore. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Show/hide payment details based on selected method
        document.getElementById('paymentMethod').addEventListener('change', function() {
            const method = this.value;
            const cardDetails = document.getElementById('cardDetails');
            const paypalDetails = document.getElementById('paypalDetails');
            const bankDetails = document.getElementById('bankDetails');
            
            // Hide all details
            cardDetails.style.display = 'none';
            paypalDetails.style.display = 'none';
            bankDetails.style.display = 'none';
            
            // Show relevant details
            if (method === 'CREDIT_CARD' || method === 'DEBIT_CARD') {
                cardDetails.style.display = 'block';
            } else if (method === 'PAYPAL') {
                paypalDetails.style.display = 'block';
            } else if (method === 'BANK_TRANSFER') {
                bankDetails.style.display = 'block';
            }
        });
        
        // Format card number input
        document.getElementById('cardNumber').addEventListener('input', function() {
            let value = this.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            this.value = formattedValue;
        });
    </script>
</body>
</html>